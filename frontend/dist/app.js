(function() {
  angular.module('RPiCar', ['ngResource', 'ngSanitize', 'ngRoute', 'ngAnimate', 'ngStorage', 'ui.bootstrap', 'swUtils']).config(function($routeProvider) {
    return $routeProvider.when('/', {
      templateUrl: 'controllers/main.html',
      controller: 'MainCtrl',
      label: ''
    }).when('/current/', {
      templateUrl: 'controllers/car.html',
      controller: 'CarCtrl',
      label: 'Current Car'
    });
  }).run(function($location, $rootScope, swTitle) {
    $rootScope.swTitle = swTitle;
    return $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {
      var baseTitle, ref;
      baseTitle = ((ref = current.$$route) != null ? ref.label : void 0) || '';
      swTitle.setTitleBase(baseTitle);
      swTitle.setTitleStart('');
      return swTitle.setTitleEnd('');
    });
  }).config(function($httpProvider) {
    return $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
  });

}).call(this);

(function() {
  var BACKWARD_KEY_CODE, BTN_DIRECTIONS, FORWARD_KEY_CODE, LEFT_KEY_CODE, RIGHT_KEY_CODE, SPACE_KEY_CODE;

  SPACE_KEY_CODE = 32;

  FORWARD_KEY_CODE = 38;

  BACKWARD_KEY_CODE = 40;

  LEFT_KEY_CODE = 37;

  RIGHT_KEY_CODE = 39;

  BTN_DIRECTIONS = {
    forwardBtn: 'forward',
    backwardBtn: 'backward',
    leftBtn: 'left',
    rightBtn: 'right'
  };

  angular.module('RPiCar').controller('CarCtrl', function($scope, $routeParams, $http, $log, $interval, $localStorage, $location, car) {
    var _getDirection, cancelInterval, currentIntervals, sendCommand, sendMoveStatus;
    if (!car.getCurrentCar()) {
      $location.path('/');
    }
    $scope.car = car.getCurrentCar();
    $scope.speed = $localStorage.speed || 100;
    $scope.setSpeed = function(value) {
      $localStorage.speed = value;
      return $scope.speed = value;
    };
    $scope.moveStatus = {
      forward: false,
      backward: false,
      left: false,
      right: false
    };
    setupWebSocket($scope.car.address);
    $scope.commandLog = [];
    $scope.carCommandHandler = function(commandResponse) {
      var item;
      item = {
        response: JSON.parse(commandResponse),
        dt: new Date()
      };
      $scope.commandLog.unshift(item);
      if ($scope.commandLog.length > 5) {
        return $scope.commandLog.length = 5;
      }
    };
    $scope.move = function(direction, state) {
      var oldState;
      oldState = $scope.moveStatus[direction];
      $scope.moveStatus[direction] = state;
      if (oldState !== state) {
        return sendMoveStatus(direction, state);
      }
    };
    $scope.keyDownHandler = function(event) {
      var direction;
      if (event.keyCode === 49) {
        $scope.setSpeed(60);
      } else if (event.keyCode === 50) {
        $scope.setSpeed(80);
      } else if (event.keyCode === 51) {
        $scope.setSpeed(100);
      }
      direction = _getDirection(event);
      if (direction) {
        return $scope.move(direction, true);
      }
    };
    $scope.keyUpHandler = function(event) {
      var direction;
      direction = _getDirection(event);
      if (direction) {
        return $scope.move(direction, false);
      }
    };
    $scope.rotateVideo = function(addDegrees) {
      var rotate;
      rotate = $localStorage.rotate || 0;
      rotate += addDegrees || 0;
      if (rotate >= 360) {
        rotate = 0;
      }
      $localStorage.rotate = rotate;
      return $('#videoCanvas').css('transform', "rotate(" + rotate + "deg)");
    };
    $scope.rotateVideo();
    _getDirection = function(event) {
      var direction;
      if (event.keyCode === SPACE_KEY_CODE && event.target.type === 'button') {
        direction = BTN_DIRECTIONS[event.target.id];
        return direction;
      }
      if (event.keyCode === FORWARD_KEY_CODE) {
        return 'forward';
      }
      if (event.keyCode === BACKWARD_KEY_CODE) {
        return 'reverse';
      }
      if (event.keyCode === LEFT_KEY_CODE) {
        return 'left';
      }
      if (event.keyCode === RIGHT_KEY_CODE) {
        return 'right';
      }
      return void 0;
    };
    currentIntervals = {};
    sendMoveStatus = function(direction, state) {
      console.debug(direction, state);
      if (state) {
        sendCommand(direction);
        cancelInterval(direction);
        return currentIntervals[direction] = $interval(function() {
          return sendCommand(direction);
        }, 300);
      } else {
        cancelInterval(direction);
        if (direction === 'forward' || direction === 'reverse') {
          return sendCommand('stop');
        } else if (direction === 'left' || direction === 'right') {
          return sendCommand('center');
        }
      }
    };
    cancelInterval = function(name) {
      if (currentIntervals[name]) {
        $interval.cancel(currentIntervals[name]);
        return delete currentIntervals[name];
      }
    };
    return sendCommand = function(commandName) {
      var params, url, value;
      console.debug(commandName);
      value = '';
      if (commandName === 'forward' || commandName === 'reverse') {
        value = $scope.speed;
      }
      url = $scope.car.url + "command/";
      params = {
        name: commandName,
        value: value
      };
      return $http.post(url, $.param(params));
    };
  });

}).call(this);

(function() {
  angular.module('RPiCar').controller('MainCtrl', function($scope, $log, $localStorage, $http, $location, car) {
    $scope.cars = [];
    $scope.network = $localStorage.network;
    $scope.scan = function() {
      var address, i, j, results, url;
      $scope.cars.length = 0;
      $localStorage.network = $scope.network;
      results = [];
      for (i = j = 1; j <= 254; i = ++j) {
        address = "" + $scope.network + i;
        url = "http://" + address + ":4242/";
        results.push($http.get(url).then(function(result) {
          return $scope.cars.push({
            address: result.data.address,
            url: result.config.url,
            name: result.data.name
          });
        }, function() {}));
      }
      return results;
    };
    if ($scope.network) {
      $scope.scan();
    }
    return $scope.openCar = function(currentCar) {
      car.setCurrentCar(currentCar);
      return $location.path('/current/');
    };
  });

}).call(this);

(function() {
  angular.module('RPiCar').service('car', function($localStorage) {
    this.setCurrentCar = function(car) {
      return $localStorage.currentCar = car;
    };
    this.getCurrentCar = function() {
      return $localStorage.currentCar;
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHAuY29mZmVlIiwiYXBwL2NvbnRyb2xsZXJzL2Nhci5jb2ZmZWUiLCJhcHAvY29udHJvbGxlcnMvbWFpbi5jb2ZmZWUiLCJhcHAvc2VydmljZXMvY2FyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBLE9BQU8sQ0FBQyxNQUFSLENBQWUsUUFBZixFQUF5QixDQUNyQixZQURxQixFQUVyQixZQUZxQixFQUdyQixTQUhxQixFQUlyQixXQUpxQixFQUtyQixXQUxxQixFQU9yQixjQVBxQixFQVNyQixTQVRxQixDQUF6QixDQWFBLENBQUMsTUFiRCxDQWFRLFNBQUMsY0FBRDtXQUNKLGNBQ0ksQ0FBQyxJQURMLENBQ1UsR0FEVixFQUVNO01BQUEsV0FBQSxFQUFhLHVCQUFiO01BQ0EsVUFBQSxFQUFZLFVBRFo7TUFFQSxLQUFBLEVBQU8sRUFGUDtLQUZOLENBTUksQ0FBQyxJQU5MLENBTVUsV0FOVixFQU9NO01BQUEsV0FBQSxFQUFhLHNCQUFiO01BQ0EsVUFBQSxFQUFZLFNBRFo7TUFFQSxLQUFBLEVBQU8sYUFGUDtLQVBOO0VBREksQ0FiUixDQTJCQSxDQUFDLEdBM0JELENBMkJLLFNBQUMsU0FBRCxFQUFZLFVBQVosRUFBd0IsT0FBeEI7SUFDRCxVQUFVLENBQUMsT0FBWCxHQUFxQjtXQUNyQixVQUFVLENBQUMsR0FBWCxDQUFlLHFCQUFmLEVBQXNDLFNBQUMsS0FBRCxFQUFRLE9BQVIsRUFBaUIsUUFBakI7QUFDbEMsVUFBQTtNQUFBLFNBQUEseUNBQTJCLENBQUUsZUFBakIsSUFBMEI7TUFDdEMsT0FBTyxDQUFDLFlBQVIsQ0FBcUIsU0FBckI7TUFDQSxPQUFPLENBQUMsYUFBUixDQUFzQixFQUF0QjthQUNBLE9BQU8sQ0FBQyxXQUFSLENBQW9CLEVBQXBCO0lBSmtDLENBQXRDO0VBRkMsQ0EzQkwsQ0FvQ0EsQ0FBQyxNQXBDRCxDQW9DUSxTQUFDLGFBQUQ7V0FDSixhQUFhLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FB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LEdBQUQ7YUFDakIsYUFBYSxDQUFDLFVBQWQsR0FBMkI7SUFEVjtJQUdyQixJQUFJLENBQUMsYUFBTCxHQUFxQixTQUFBO0FBQ2pCLGFBQU8sYUFBYSxDQUFDO0lBREo7RUFMVCxDQURoQjtBQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImFuZ3VsYXIubW9kdWxlKCdSUGlDYXInLCBbXG4gICAgJ25nUmVzb3VyY2UnXG4gICAgJ25nU2FuaXRpemUnXG4gICAgJ25nUm91dGUnXG4gICAgJ25nQW5pbWF0ZSdcbiAgICAnbmdTdG9yYWdlJyxcblxuICAgICd1aS5ib290c3RyYXAnXG5cbiAgICAnc3dVdGlscydcbl0pXG5cblxuLmNvbmZpZyAoJHJvdXRlUHJvdmlkZXIpIC0+XG4gICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgICAgLndoZW4oJy8nLFxuICAgICAgICAgIHRlbXBsYXRlVXJsOiAnY29udHJvbGxlcnMvbWFpbi5odG1sJ1xuICAgICAgICAgIGNvbnRyb2xsZXI6ICdNYWluQ3RybCdcbiAgICAgICAgICBsYWJlbDogJydcbiAgICAgICAgKVxuICAgICAgICAud2hlbignL2N1cnJlbnQvJyxcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbnRyb2xsZXJzL2Nhci5odG1sJ1xuICAgICAgICAgIGNvbnRyb2xsZXI6ICdDYXJDdHJsJ1xuICAgICAgICAgIGxhYmVsOiAnQ3VycmVudCBDYXInXG4gICAgICAgIClcblxuXG4ucnVuICgkbG9jYXRpb24sICRyb290U2NvcGUsIHN3VGl0bGUpIC0+XG4gICAgJHJvb3RTY29wZS5zd1RpdGxlID0gc3dUaXRsZVxuICAgICRyb290U2NvcGUuJG9uICckcm91dGVDaGFuZ2VTdWNjZXNzJywgKGV2ZW50LCBjdXJyZW50LCBwcmV2aW91cykgLT5cbiAgICAgICAgYmFzZVRpdGxlID0gY3VycmVudC4kJHJvdXRlPy5sYWJlbCBvciAnJ1xuICAgICAgICBzd1RpdGxlLnNldFRpdGxlQmFzZShiYXNlVGl0bGUpXG4gICAgICAgIHN3VGl0bGUuc2V0VGl0bGVTdGFydCgnJylcbiAgICAgICAgc3dUaXRsZS5zZXRUaXRsZUVuZCgnJylcblxuXG4uY29uZmlnICgkaHR0cFByb3ZpZGVyKSAtPlxuICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5wb3N0WydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIiwiU1BBQ0VfS0VZX0NPREUgPSAzMlxuXG5GT1JXQVJEX0tFWV9DT0RFID0gMzhcbkJBQ0tXQVJEX0tFWV9DT0RFID0gNDBcbkxFRlRfS0VZX0NPREUgPSAzN1xuUklHSFRfS0VZX0NPREUgPSAzOVxuXG5CVE5fRElSRUNUSU9OUyA9IHtcbiAgICBmb3J3YXJkQnRuOiAnZm9yd2FyZCdcbiAgICBiYWNrd2FyZEJ0bjogJ2JhY2t3YXJkJ1xuICAgIGxlZnRCdG46ICdsZWZ0J1xuICAgIHJpZ2h0QnRuOiAncmlnaHQnXG59XG5cbmFuZ3VsYXIubW9kdWxlKCdSUGlDYXInKVxuLmNvbnRyb2xsZXIgJ0NhckN0cmwnLCAoJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkbG9nLCAkaW50ZXJ2YWwsICRsb2NhbFN0b3JhZ2UsICRsb2NhdGlvbiwgY2FyKSAtPlxuICAgICMg0LXRgdC70Lgg0L3QtdGCINC90LXQutGD0YnQtdC5INGC0LDRh9C60LhcbiAgICBpZiBub3QgY2FyLmdldEN1cnJlbnRDYXIoKVxuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpXG5cbiAgICAkc2NvcGUuY2FyID0gY2FyLmdldEN1cnJlbnRDYXIoKVxuICAgICRzY29wZS5zcGVlZCA9ICRsb2NhbFN0b3JhZ2Uuc3BlZWQgb3IgMTAwXG4gICAgJHNjb3BlLnNldFNwZWVkID0gKHZhbHVlKSAtPlxuICAgICAgICAkbG9jYWxTdG9yYWdlLnNwZWVkID0gdmFsdWVcbiAgICAgICAgJHNjb3BlLnNwZWVkID0gdmFsdWVcblxuICAgICRzY29wZS5tb3ZlU3RhdHVzID0ge1xuICAgICAgICBmb3J3YXJkOiBmYWxzZVxuICAgICAgICBiYWNrd2FyZDogZmFsc2VcbiAgICAgICAgbGVmdDogZmFsc2VcbiAgICAgICAgcmlnaHQ6IGZhbHNlXG4gICAgfVxuXG4gICAgc2V0dXBXZWJTb2NrZXQoJHNjb3BlLmNhci5hZGRyZXNzKTtcblxuICAgICRzY29wZS5jb21tYW5kTG9nID0gW11cbiAgICAkc2NvcGUuY2FyQ29tbWFuZEhhbmRsZXIgPSAoY29tbWFuZFJlc3BvbnNlKSAtPlxuICAgICAgICBpdGVtID0ge1xuICAgICAgICAgICAgcmVzcG9uc2U6IEpTT04ucGFyc2UoY29tbWFuZFJlc3BvbnNlKVxuICAgICAgICAgICAgZHQ6IG5ldyBEYXRlKClcbiAgICAgICAgfVxuICAgICAgICAkc2NvcGUuY29tbWFuZExvZy51bnNoaWZ0KGl0ZW0pXG5cbiAgICAgICAgaWYgJHNjb3BlLmNvbW1hbmRMb2cubGVuZ3RoID4gNVxuICAgICAgICAgICAgJHNjb3BlLmNvbW1hbmRMb2cubGVuZ3RoID0gNVxuXG5cblxuICAgICRzY29wZS5tb3ZlID0gKGRpcmVjdGlvbiwgc3RhdGUpIC0+XG4gICAgICAgIG9sZFN0YXRlID0gJHNjb3BlLm1vdmVTdGF0dXNbZGlyZWN0aW9uXVxuICAgICAgICAkc2NvcGUubW92ZVN0YXR1c1tkaXJlY3Rpb25dID0gc3RhdGVcbiAgICAgICAgaWYgb2xkU3RhdGUgIT0gc3RhdGVcbiMgICAgICAgICAgICBzZW5kTW92ZVN0YXR1cygkc2NvcGUubW92ZVN0YXR1cylcbiAgICAgICAgICAgIHNlbmRNb3ZlU3RhdHVzKGRpcmVjdGlvbiwgc3RhdGUpXG5cblxuICAgICRzY29wZS5rZXlEb3duSGFuZGxlciA9IChldmVudCkgLT5cbiAgICAgICAgIyDQv9C10YDQtdC60LvRjtGH0LXQvdC40LUg0YHQutC+0YDQvtGB0YLQtdC5XG4gICAgICAgIGlmIGV2ZW50LmtleUNvZGUgPT0gNDlcbiAgICAgICAgICAgICRzY29wZS5zZXRTcGVlZCg2MClcbiAgICAgICAgZWxzZSBpZiBldmVudC5rZXlDb2RlID09IDUwXG4gICAgICAgICAgICAkc2NvcGUuc2V0U3BlZWQoODApXG4gICAgICAgIGVsc2UgaWYgZXZlbnQua2V5Q29kZSA9PSA1MVxuICAgICAgICAgICAgJHNjb3BlLnNldFNwZWVkKDEwMClcblxuICAgICAgICBkaXJlY3Rpb24gPSBfZ2V0RGlyZWN0aW9uKGV2ZW50KVxuICAgICAgICBpZiBkaXJlY3Rpb25cbiAgICAgICAgICAgICRzY29wZS5tb3ZlKGRpcmVjdGlvbiwgdHJ1ZSlcblxuICAgICRzY29wZS5rZXlVcEhhbmRsZXIgPSAoZXZlbnQpIC0+XG4gICAgICAgIGRpcmVjdGlvbiA9IF9nZXREaXJlY3Rpb24oZXZlbnQpXG4gICAgICAgIGlmIGRpcmVjdGlvblxuICAgICAgICAgICAgJHNjb3BlLm1vdmUoZGlyZWN0aW9uLCBmYWxzZSlcblxuICAgICRzY29wZS5yb3RhdGVWaWRlbyA9IChhZGREZWdyZWVzKSAtPlxuICAgICAgICByb3RhdGUgPSAkbG9jYWxTdG9yYWdlLnJvdGF0ZSBvciAwXG5cbiAgICAgICAgcm90YXRlICs9IGFkZERlZ3JlZXMgb3IgMFxuICAgICAgICBpZiByb3RhdGUgPj0gMzYwXG4gICAgICAgICAgICByb3RhdGUgPSAwXG5cbiAgICAgICAgJGxvY2FsU3RvcmFnZS5yb3RhdGUgPSByb3RhdGVcbiAgICAgICAgJCgnI3ZpZGVvQ2FudmFzJykuY3NzKCd0cmFuc2Zvcm0nLCBcInJvdGF0ZSgje3JvdGF0ZX1kZWcpXCIpXG4gICAgJHNjb3BlLnJvdGF0ZVZpZGVvKClcblxuICAgIF9nZXREaXJlY3Rpb24gPSAoZXZlbnQpIC0+XG4gICAgICAgIGlmIGV2ZW50LmtleUNvZGUgPT0gU1BBQ0VfS0VZX0NPREUgYW5kIGV2ZW50LnRhcmdldC50eXBlID09ICdidXR0b24nXG4gICAgICAgICAgICBkaXJlY3Rpb24gPSBCVE5fRElSRUNUSU9OU1tldmVudC50YXJnZXQuaWRdXG4gICAgICAgICAgICByZXR1cm4gZGlyZWN0aW9uXG5cbiAgICAgICAgaWYgZXZlbnQua2V5Q29kZSA9PSBGT1JXQVJEX0tFWV9DT0RFXG4gICAgICAgICAgICByZXR1cm4gJ2ZvcndhcmQnXG5cbiAgICAgICAgaWYgZXZlbnQua2V5Q29kZSA9PSBCQUNLV0FSRF9LRVlfQ09ERVxuICAgICAgICAgICAgcmV0dXJuICdyZXZlcnNlJ1xuXG4gICAgICAgIGlmIGV2ZW50LmtleUNvZGUgPT0gTEVGVF9LRVlfQ09ERVxuICAgICAgICAgICAgcmV0dXJuICdsZWZ0J1xuXG4gICAgICAgIGlmIGV2ZW50LmtleUNvZGUgPT0gUklHSFRfS0VZX0NPREVcbiAgICAgICAgICAgIHJldHVybiAncmlnaHQnXG5cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuXG4gICAgY3VycmVudEludGVydmFscyA9IHt9XG4gICAgc2VuZE1vdmVTdGF0dXMgPSAoZGlyZWN0aW9uLCBzdGF0ZSkgLT5cbiMgICAgICAgIGRhdGEgPSBKU09OLnN0cmluZ2lmeShtb3ZlU3RhdHVzKVxuICAgICAgICBjb25zb2xlLmRlYnVnKGRpcmVjdGlvbiwgc3RhdGUpXG5cbiAgICAgICAgaWYgc3RhdGVcbiAgICAgICAgICAgIHNlbmRDb21tYW5kKGRpcmVjdGlvbilcbiAgICAgICAgICAgIGNhbmNlbEludGVydmFsKGRpcmVjdGlvbikgICAjINC90LAg0LLRgdGP0LrQuNC5INGB0LvRg9GH0LDQuVxuICAgICAgICAgICAgY3VycmVudEludGVydmFsc1tkaXJlY3Rpb25dID0gJGludGVydmFsKFxuICAgICAgICAgICAgICAgIC0+XG4gICAgICAgICAgICAgICAgICAgIHNlbmRDb21tYW5kKGRpcmVjdGlvbilcbiAgICAgICAgICAgICAgICAzMDBcbiAgICAgICAgICAgIClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgY2FuY2VsSW50ZXJ2YWwoZGlyZWN0aW9uKVxuXG4gICAgICAgICAgICBpZiBkaXJlY3Rpb24gPT0gJ2ZvcndhcmQnIG9yIGRpcmVjdGlvbiA9PSAncmV2ZXJzZSdcbiAgICAgICAgICAgICAgICBzZW5kQ29tbWFuZCgnc3RvcCcpXG4gICAgICAgICAgICBlbHNlIGlmIGRpcmVjdGlvbiA9PSAnbGVmdCcgb3IgZGlyZWN0aW9uID09ICdyaWdodCdcbiAgICAgICAgICAgICAgICBzZW5kQ29tbWFuZCgnY2VudGVyJylcblxuICAgIGNhbmNlbEludGVydmFsID0gKG5hbWUpIC0+XG4gICAgICAgIGlmIGN1cnJlbnRJbnRlcnZhbHNbbmFtZV1cbiAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY3VycmVudEludGVydmFsc1tuYW1lXSlcbiAgICAgICAgICAgIGRlbGV0ZSBjdXJyZW50SW50ZXJ2YWxzW25hbWVdXG5cblxuICAgIHNlbmRDb21tYW5kID0gKGNvbW1hbmROYW1lKSAtPlxuICAgICAgICBjb25zb2xlLmRlYnVnKGNvbW1hbmROYW1lKVxuXG4gICAgICAgIHZhbHVlID0gJydcbiAgICAgICAgaWYgY29tbWFuZE5hbWUgPT0gJ2ZvcndhcmQnIG9yIGNvbW1hbmROYW1lID09ICdyZXZlcnNlJ1xuICAgICAgICAgICAgdmFsdWUgPSAkc2NvcGUuc3BlZWRcblxuICAgICAgICB1cmwgPSBcIiN7JHNjb3BlLmNhci51cmx9Y29tbWFuZC9cIlxuICAgICAgICBwYXJhbXMgPSB7bmFtZTogY29tbWFuZE5hbWUsIHZhbHVlOiB2YWx1ZX1cbiAgICAgICAgJGh0dHAucG9zdCh1cmwsICQucGFyYW0ocGFyYW1zKSlcbiIsImFuZ3VsYXIubW9kdWxlKCdSUGlDYXInKVxuLmNvbnRyb2xsZXIgJ01haW5DdHJsJywgKCRzY29wZSwgJGxvZywgJGxvY2FsU3RvcmFnZSwgJGh0dHAsICRsb2NhdGlvbiwgY2FyKSAtPlxuICAgICRzY29wZS5jYXJzID0gW11cbiAgICAkc2NvcGUubmV0d29yayA9ICRsb2NhbFN0b3JhZ2UubmV0d29ya1xuXG4gICAgJHNjb3BlLnNjYW4gPSAtPlxuICAgICAgICAkc2NvcGUuY2Fycy5sZW5ndGggPSAwXG4gICAgICAgICRsb2NhbFN0b3JhZ2UubmV0d29yayA9ICRzY29wZS5uZXR3b3JrXG5cbiAgICAgICAgZm9yIGkgaW4gWzEuLjI1NF1cbiAgICAgICAgICAgIGFkZHJlc3MgPSBcIiN7ICRzY29wZS5uZXR3b3JrIH0jeyBpIH1cIlxuXG4gICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly8je2FkZHJlc3N9OjQyNDIvXCJcbiAgICAgICAgICAgICRodHRwLmdldCh1cmwpLnRoZW4oXG4gICAgICAgICAgICAgICAgKHJlc3VsdCkgLT5cbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiByZXN1bHQuZGF0YS5hZGRyZXNzXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHJlc3VsdC5jb25maWcudXJsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiByZXN1bHQuZGF0YS5uYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLT5cbiAgICAgICAgICAgIClcblxuICAgIGlmICRzY29wZS5uZXR3b3JrXG4gICAgICAgICRzY29wZS5zY2FuKClcblxuICAgICRzY29wZS5vcGVuQ2FyID0gKGN1cnJlbnRDYXIpIC0+XG4gICAgICAgIGNhci5zZXRDdXJyZW50Q2FyKGN1cnJlbnRDYXIpXG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY3VycmVudC8nKSIsImFuZ3VsYXIubW9kdWxlKCdSUGlDYXInKVxuLnNlcnZpY2UgJ2NhcicsICgkbG9jYWxTdG9yYWdlKSAtPlxuXG4gICAgdGhpcy5zZXRDdXJyZW50Q2FyID0gKGNhcikgLT5cbiAgICAgICAgJGxvY2FsU3RvcmFnZS5jdXJyZW50Q2FyID0gY2FyXG5cbiAgICB0aGlzLmdldEN1cnJlbnRDYXIgPSAtPlxuICAgICAgICByZXR1cm4gJGxvY2FsU3RvcmFnZS5jdXJyZW50Q2FyXG5cbiAgICByZXR1cm5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
