(function() {
  angular.module('RPiCar', ['ngResource', 'ngSanitize', 'ngRoute', 'ngAnimate', 'ngStorage', 'ui.bootstrap', 'swUtils']).config(function($routeProvider) {
    return $routeProvider.when('/', {
      templateUrl: 'controllers/main.html',
      controller: 'MainCtrl',
      label: ''
    }).when('/current/', {
      templateUrl: 'controllers/car.html',
      controller: 'CarCtrl',
      label: 'Current Car'
    });
  }).run(function($location, $rootScope, swTitle) {
    $rootScope.swTitle = swTitle;
    return $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {
      var baseTitle, ref;
      baseTitle = ((ref = current.$$route) != null ? ref.label : void 0) || '';
      swTitle.setTitleBase(baseTitle);
      swTitle.setTitleStart('');
      return swTitle.setTitleEnd('');
    });
  }).config(function($httpProvider) {
    return $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
  });

}).call(this);

(function() {
  var BACKWARD_KEY_CODE, BTN_DIRECTIONS, FORWARD_KEY_CODE, LEFT_KEY_CODE, RIGHT_KEY_CODE, SPACE_KEY_CODE;

  SPACE_KEY_CODE = 32;

  FORWARD_KEY_CODE = 38;

  BACKWARD_KEY_CODE = 40;

  LEFT_KEY_CODE = 37;

  RIGHT_KEY_CODE = 39;

  BTN_DIRECTIONS = {
    forwardBtn: 'forward',
    backwardBtn: 'backward',
    leftBtn: 'left',
    rightBtn: 'right'
  };

  angular.module('RPiCar').controller('CarCtrl', function($scope, $routeParams, $http, $log, $interval, $localStorage, $location, car) {
    var _getDirection, cancelInterval, currentIntervals, sendCommand, sendMoveStatus;
    if (!car.getCurrentCar()) {
      $location.path('/');
    }
    $scope.car = car.getCurrentCar();
    $scope.speed = $localStorage.speed || 100;
    $scope.setSpeed = function(value) {
      $localStorage.speed = value;
      return $scope.speed = value;
    };
    $scope.moveStatus = {
      forward: false,
      backward: false,
      left: false,
      right: false
    };
    $scope.commandLog = [];
    $scope.carCommandHandler = function(commandResponse) {
      var item;
      item = {
        response: JSON.parse(commandResponse),
        dt: new Date()
      };
      $scope.commandLog.unshift(item);
      if ($scope.commandLog.length > 5) {
        return $scope.commandLog.length = 5;
      }
    };
    $scope.move = function(direction, state) {
      var oldState;
      oldState = $scope.moveStatus[direction];
      $scope.moveStatus[direction] = state;
      if (oldState !== state) {
        return sendMoveStatus(direction, state);
      }
    };
    $scope.keyDownHandler = function(event) {
      var direction;
      direction = _getDirection(event);
      if (direction) {
        return $scope.move(direction, true);
      }
    };
    $scope.keyUpHandler = function(event) {
      var direction;
      direction = _getDirection(event);
      if (direction) {
        return $scope.move(direction, false);
      }
    };
    _getDirection = function(event) {
      var direction;
      if (event.keyCode === SPACE_KEY_CODE && event.target.type === 'button') {
        direction = BTN_DIRECTIONS[event.target.id];
        return direction;
      }
      if (event.keyCode === FORWARD_KEY_CODE) {
        return 'forward';
      }
      if (event.keyCode === BACKWARD_KEY_CODE) {
        return 'reverse';
      }
      if (event.keyCode === LEFT_KEY_CODE) {
        return 'left';
      }
      if (event.keyCode === RIGHT_KEY_CODE) {
        return 'right';
      }
      return void 0;
    };
    currentIntervals = {};
    sendMoveStatus = function(direction, state) {
      console.debug(direction, state);
      if (state) {
        sendCommand(direction);
        cancelInterval(direction);
        return currentIntervals[direction] = $interval(function() {
          return sendCommand(direction);
        }, 300);
      } else {
        cancelInterval(direction);
        if (direction === 'forward' || direction === 'reverse') {
          return sendCommand('stop');
        } else if (direction === 'left' || direction === 'right') {
          return sendCommand('center');
        }
      }
    };
    cancelInterval = function(name) {
      if (currentIntervals[name]) {
        $interval.cancel(currentIntervals[name]);
        return delete currentIntervals[name];
      }
    };
    return sendCommand = function(commandName) {
      var params, url, value;
      console.debug(commandName);
      value = '';
      if (commandName === 'forward' || commandName === 'reverse') {
        value = $scope.speed;
      }
      url = $scope.car.url + "command/";
      params = {
        name: commandName,
        value: value
      };
      return $http.post(url, $.param(params));
    };
  });

}).call(this);

(function() {
  angular.module('RPiCar').controller('MainCtrl', function($scope, $log, $localStorage, $http, $location, car) {
    $scope.cars = [];
    $scope.network = $localStorage.network;
    $scope.scan = function() {
      var address, i, j, results, url;
      $scope.cars.length = 0;
      $localStorage.network = $scope.network;
      results = [];
      for (i = j = 1; j <= 254; i = ++j) {
        address = "" + $scope.network + i;
        url = "http://" + address + ":4242/";
        results.push($http.get(url).then(function(result) {
          return $scope.cars.push({
            url: result.config.url,
            name: result.data.name
          });
        }, function() {}));
      }
      return results;
    };
    if ($scope.network) {
      $scope.scan();
    }
    return $scope.openCar = function(currentCar) {
      car.setCurrentCar(currentCar);
      return $location.path('/current/');
    };
  });

}).call(this);

(function() {
  angular.module('RPiCar').service('car', function($localStorage) {
    this.setCurrentCar = function(car) {
      return $localStorage.currentCar = car;
    };
    this.getCurrentCar = function() {
      return $localStorage.currentCar;
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHAuY29mZmVlIiwiYXBwL2NvbnRyb2xsZXJzL2Nhci5jb2ZmZWUiLCJhcHAvY29udHJvbGxlcnMvbWFpbi5jb2ZmZWUiLCJhcHAvc2VydmljZXMvY2FyLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBLE9BQU8sQ0FBQyxNQUFSLENBQWUsUUFBZixFQUF5QixDQUNyQixZQURxQixFQUVyQixZQUZxQixFQUdyQixTQUhxQixFQUlyQixXQUpxQixFQUtyQixXQUxxQixFQU9yQixjQVBxQixFQVNyQixTQVRxQixDQUF6QixDQWFBLENBQUMsTUFiRCxDQWFRLFNBQUMsY0FBRDtXQUNKLGNBQ0ksQ0FBQyxJQURMLENBQ1UsR0FEVixFQUVNO01BQUEsV0FBQSxFQUFhLHVCQUFiO01BQ0EsVUFBQSxFQUFZLFVBRFo7TUFFQSxLQUFBLEVBQU8sRUFGUDtLQUZOLENBTUksQ0FBQyxJQU5MLENBTVUsV0FOVixFQU9NO01BQUEsV0FBQSxFQUFhLHNCQUFiO01BQ0EsVUFBQSxFQUFZLFNBRFo7TUFFQSxLQUFBLEVBQU8sYUFGUDtLQVBOO0VBREksQ0FiUixDQTJCQSxDQUFDLEdBM0JELENBMkJLLFNBQUMsU0FBRCxFQUFZLFVBQVosRUFBd0IsT0FBeEI7SUFDRCxVQUFVLENBQUMsT0FBWCxHQUFxQjtXQUNyQixVQUFVLENBQUMsR0FBWCxDQUFlLHFCQUFmLEVBQXNDLFNBQUMsS0FBRCxFQUFRLE9BQVIsRUFBaUIsUUFBakI7QUFDbEMsVUFBQTtNQUFBLFNBQUEseUNBQTJCLENBQUUsZUFBakIsSUFBMEI7TUFDdEMsT0FBTyxDQUFDLFlBQVIsQ0FBcUIsU0FBckI7TUFDQSxPQUFPLENBQUMsYUFBUixDQUFzQixFQUF0QjthQUNBLE9BQU8sQ0FBQyxXQUFSLENBQW9CLEVBQXBCO0lBSmtDLENBQXRDO0VBRkMsQ0EzQkwsQ0FvQ0EsQ0FBQyxNQXBDRCxDQW9DUSxTQUFDLGFBQUQ7V0FDSixhQUFhLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FB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QUpVO0lBaUJkLElBQUcsTUFBTSxDQUFDLE9BQVY7TUFDSSxNQUFNLENBQUMsSUFBUCxDQUFBLEVBREo7O1dBR0EsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxVQUFEO01BQ2IsR0FBRyxDQUFDLGFBQUosQ0FBa0IsVUFBbEI7YUFDQSxTQUFTLENBQUMsSUFBVixDQUFlLFdBQWY7SUFGYTtFQXhCRyxDQUR4QjtBQUFBOzs7QUNBQTtFQUFBLE9BQU8sQ0FBQyxNQUFSLENBQWUsUUFBZixDQUNBLENBQUMsT0FERCxDQUNTLEtBRFQsRUFDZ0IsU0FBQyxhQUFEO0lBRVosSUFBSSxDQUFDLGFBQUwsR0FBcUIsU0FBQyxHQUFEO2FBQ2pCLGFBQWEsQ0FBQyxVQUFkLEdBQTJCO0lBRFY7SUFHckIsSUFBSSxDQUFDLGFBQUwsR0FBcUIsU0FBQTtBQUNqQixhQUFPLGFBQWEsQ0FBQztJQURKO0VBTFQsQ0FEaEI7QUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnUlBpQ2FyJywgW1xuICAgICduZ1Jlc291cmNlJ1xuICAgICduZ1Nhbml0aXplJ1xuICAgICduZ1JvdXRlJ1xuICAgICduZ0FuaW1hdGUnXG4gICAgJ25nU3RvcmFnZScsXG5cbiAgICAndWkuYm9vdHN0cmFwJ1xuXG4gICAgJ3N3VXRpbHMnXG5dKVxuXG5cbi5jb25maWcgKCRyb3V0ZVByb3ZpZGVyKSAtPlxuICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAgIC53aGVuKCcvJyxcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbnRyb2xsZXJzL21haW4uaHRtbCdcbiAgICAgICAgICBjb250cm9sbGVyOiAnTWFpbkN0cmwnXG4gICAgICAgICAgbGFiZWw6ICcnXG4gICAgICAgIClcbiAgICAgICAgLndoZW4oJy9jdXJyZW50LycsXG4gICAgICAgICAgdGVtcGxhdGVVcmw6ICdjb250cm9sbGVycy9jYXIuaHRtbCdcbiAgICAgICAgICBjb250cm9sbGVyOiAnQ2FyQ3RybCdcbiAgICAgICAgICBsYWJlbDogJ0N1cnJlbnQgQ2FyJ1xuICAgICAgICApXG5cblxuLnJ1biAoJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCBzd1RpdGxlKSAtPlxuICAgICRyb290U2NvcGUuc3dUaXRsZSA9IHN3VGl0bGVcbiAgICAkcm9vdFNjb3BlLiRvbiAnJHJvdXRlQ2hhbmdlU3VjY2VzcycsIChldmVudCwgY3VycmVudCwgcHJldmlvdXMpIC0+XG4gICAgICAgIGJhc2VUaXRsZSA9IGN1cnJlbnQuJCRyb3V0ZT8ubGFiZWwgb3IgJydcbiAgICAgICAgc3dUaXRsZS5zZXRUaXRsZUJhc2UoYmFzZVRpdGxlKVxuICAgICAgICBzd1RpdGxlLnNldFRpdGxlU3RhcnQoJycpXG4gICAgICAgIHN3VGl0bGUuc2V0VGl0bGVFbmQoJycpXG5cblxuLmNvbmZpZyAoJGh0dHBQcm92aWRlcikgLT5cbiAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMucG9zdFsnQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyIsIlNQQUNFX0tFWV9DT0RFID0gMzJcblxuRk9SV0FSRF9LRVlfQ09ERSA9IDM4XG5CQUNLV0FSRF9LRVlfQ09ERSA9IDQwXG5MRUZUX0tFWV9DT0RFID0gMzdcblJJR0hUX0tFWV9DT0RFID0gMzlcblxuQlROX0RJUkVDVElPTlMgPSB7XG4gICAgZm9yd2FyZEJ0bjogJ2ZvcndhcmQnXG4gICAgYmFja3dhcmRCdG46ICdiYWNrd2FyZCdcbiAgICBsZWZ0QnRuOiAnbGVmdCdcbiAgICByaWdodEJ0bjogJ3JpZ2h0J1xufVxuXG5hbmd1bGFyLm1vZHVsZSgnUlBpQ2FyJylcbi5jb250cm9sbGVyICdDYXJDdHJsJywgKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkaHR0cCwgJGxvZywgJGludGVydmFsLCAkbG9jYWxTdG9yYWdlLCAkbG9jYXRpb24sIGNhcikgLT5cbiAgICAjINC10YHQu9C4INC90LXRgiDQvdC10LrRg9GJ0LXQuSDRgtCw0YfQutC4XG4gICAgaWYgbm90IGNhci5nZXRDdXJyZW50Q2FyKClcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKVxuXG4gICAgJHNjb3BlLmNhciA9IGNhci5nZXRDdXJyZW50Q2FyKClcbiAgICAkc2NvcGUuc3BlZWQgPSAkbG9jYWxTdG9yYWdlLnNwZWVkIG9yIDEwMFxuICAgICRzY29wZS5zZXRTcGVlZCA9ICh2YWx1ZSkgLT5cbiAgICAgICAgJGxvY2FsU3RvcmFnZS5zcGVlZCA9IHZhbHVlXG4gICAgICAgICRzY29wZS5zcGVlZCA9IHZhbHVlXG5cbiAgICAkc2NvcGUubW92ZVN0YXR1cyA9IHtcbiAgICAgICAgZm9yd2FyZDogZmFsc2VcbiAgICAgICAgYmFja3dhcmQ6IGZhbHNlXG4gICAgICAgIGxlZnQ6IGZhbHNlXG4gICAgICAgIHJpZ2h0OiBmYWxzZVxuICAgIH1cblxuXG4gICAgJHNjb3BlLmNvbW1hbmRMb2cgPSBbXVxuICAgICRzY29wZS5jYXJDb21tYW5kSGFuZGxlciA9IChjb21tYW5kUmVzcG9uc2UpIC0+XG4gICAgICAgIGl0ZW0gPSB7XG4gICAgICAgICAgICByZXNwb25zZTogSlNPTi5wYXJzZShjb21tYW5kUmVzcG9uc2UpXG4gICAgICAgICAgICBkdDogbmV3IERhdGUoKVxuICAgICAgICB9XG4gICAgICAgICRzY29wZS5jb21tYW5kTG9nLnVuc2hpZnQoaXRlbSlcblxuICAgICAgICBpZiAkc2NvcGUuY29tbWFuZExvZy5sZW5ndGggPiA1XG4gICAgICAgICAgICAkc2NvcGUuY29tbWFuZExvZy5sZW5ndGggPSA1XG5cblxuXG4gICAgJHNjb3BlLm1vdmUgPSAoZGlyZWN0aW9uLCBzdGF0ZSkgLT5cbiAgICAgICAgb2xkU3RhdGUgPSAkc2NvcGUubW92ZVN0YXR1c1tkaXJlY3Rpb25dXG4gICAgICAgICRzY29wZS5tb3ZlU3RhdHVzW2RpcmVjdGlvbl0gPSBzdGF0ZVxuICAgICAgICBpZiBvbGRTdGF0ZSAhPSBzdGF0ZVxuIyAgICAgICAgICAgIHNlbmRNb3ZlU3RhdHVzKCRzY29wZS5tb3ZlU3RhdHVzKVxuICAgICAgICAgICAgc2VuZE1vdmVTdGF0dXMoZGlyZWN0aW9uLCBzdGF0ZSlcblxuXG4gICAgJHNjb3BlLmtleURvd25IYW5kbGVyID0gKGV2ZW50KSAtPlxuICAgICAgICBkaXJlY3Rpb24gPSBfZ2V0RGlyZWN0aW9uKGV2ZW50KVxuICAgICAgICBpZiBkaXJlY3Rpb25cbiAgICAgICAgICAgICRzY29wZS5tb3ZlKGRpcmVjdGlvbiwgdHJ1ZSlcblxuICAgICRzY29wZS5rZXlVcEhhbmRsZXIgPSAoZXZlbnQpIC0+XG4gICAgICAgIGRpcmVjdGlvbiA9IF9nZXREaXJlY3Rpb24oZXZlbnQpXG4gICAgICAgIGlmIGRpcmVjdGlvblxuICAgICAgICAgICAgJHNjb3BlLm1vdmUoZGlyZWN0aW9uLCBmYWxzZSlcblxuXG4gICAgX2dldERpcmVjdGlvbiA9IChldmVudCkgLT5cbiAgICAgICAgaWYgZXZlbnQua2V5Q29kZSA9PSBTUEFDRV9LRVlfQ09ERSBhbmQgZXZlbnQudGFyZ2V0LnR5cGUgPT0gJ2J1dHRvbidcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IEJUTl9ESVJFQ1RJT05TW2V2ZW50LnRhcmdldC5pZF1cbiAgICAgICAgICAgIHJldHVybiBkaXJlY3Rpb25cblxuICAgICAgICBpZiBldmVudC5rZXlDb2RlID09IEZPUldBUkRfS0VZX0NPREVcbiAgICAgICAgICAgIHJldHVybiAnZm9yd2FyZCdcblxuICAgICAgICBpZiBldmVudC5rZXlDb2RlID09IEJBQ0tXQVJEX0tFWV9DT0RFXG4gICAgICAgICAgICByZXR1cm4gJ3JldmVyc2UnXG5cbiAgICAgICAgaWYgZXZlbnQua2V5Q29kZSA9PSBMRUZUX0tFWV9DT0RFXG4gICAgICAgICAgICByZXR1cm4gJ2xlZnQnXG5cbiAgICAgICAgaWYgZXZlbnQua2V5Q29kZSA9PSBSSUdIVF9LRVlfQ09ERVxuICAgICAgICAgICAgcmV0dXJuICdyaWdodCdcblxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG5cbiAgICBjdXJyZW50SW50ZXJ2YWxzID0ge31cbiAgICBzZW5kTW92ZVN0YXR1cyA9IChkaXJlY3Rpb24sIHN0YXRlKSAtPlxuIyAgICAgICAgZGF0YSA9IEpTT04uc3RyaW5naWZ5KG1vdmVTdGF0dXMpXG4gICAgICAgIGNvbnNvbGUuZGVidWcoZGlyZWN0aW9uLCBzdGF0ZSlcblxuICAgICAgICBpZiBzdGF0ZVxuICAgICAgICAgICAgc2VuZENvbW1hbmQoZGlyZWN0aW9uKVxuICAgICAgICAgICAgY2FuY2VsSW50ZXJ2YWwoZGlyZWN0aW9uKSAgICMg0L3QsCDQstGB0Y/QutC40Lkg0YHQu9GD0YfQsNC5XG4gICAgICAgICAgICBjdXJyZW50SW50ZXJ2YWxzW2RpcmVjdGlvbl0gPSAkaW50ZXJ2YWwoXG4gICAgICAgICAgICAgICAgLT5cbiAgICAgICAgICAgICAgICAgICAgc2VuZENvbW1hbmQoZGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgIDMwMFxuICAgICAgICAgICAgKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBjYW5jZWxJbnRlcnZhbChkaXJlY3Rpb24pXG5cbiAgICAgICAgICAgIGlmIGRpcmVjdGlvbiA9PSAnZm9yd2FyZCcgb3IgZGlyZWN0aW9uID09ICdyZXZlcnNlJ1xuICAgICAgICAgICAgICAgIHNlbmRDb21tYW5kKCdzdG9wJylcbiAgICAgICAgICAgIGVsc2UgaWYgZGlyZWN0aW9uID09ICdsZWZ0JyBvciBkaXJlY3Rpb24gPT0gJ3JpZ2h0J1xuICAgICAgICAgICAgICAgIHNlbmRDb21tYW5kKCdjZW50ZXInKVxuXG4gICAgY2FuY2VsSW50ZXJ2YWwgPSAobmFtZSkgLT5cbiAgICAgICAgaWYgY3VycmVudEludGVydmFsc1tuYW1lXVxuICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChjdXJyZW50SW50ZXJ2YWxzW25hbWVdKVxuICAgICAgICAgICAgZGVsZXRlIGN1cnJlbnRJbnRlcnZhbHNbbmFtZV1cblxuXG4gICAgc2VuZENvbW1hbmQgPSAoY29tbWFuZE5hbWUpIC0+XG4gICAgICAgIGNvbnNvbGUuZGVidWcoY29tbWFuZE5hbWUpXG5cbiAgICAgICAgdmFsdWUgPSAnJ1xuICAgICAgICBpZiBjb21tYW5kTmFtZSA9PSAnZm9yd2FyZCcgb3IgY29tbWFuZE5hbWUgPT0gJ3JldmVyc2UnXG4gICAgICAgICAgICB2YWx1ZSA9ICRzY29wZS5zcGVlZFxuXG4gICAgICAgIHVybCA9IFwiI3skc2NvcGUuY2FyLnVybH1jb21tYW5kL1wiXG4gICAgICAgIHBhcmFtcyA9IHtuYW1lOiBjb21tYW5kTmFtZSwgdmFsdWU6IHZhbHVlfVxuICAgICAgICAkaHR0cC5wb3N0KHVybCwgJC5wYXJhbShwYXJhbXMpKVxuXG4iLCJhbmd1bGFyLm1vZHVsZSgnUlBpQ2FyJylcbi5jb250cm9sbGVyICdNYWluQ3RybCcsICgkc2NvcGUsICRsb2csICRsb2NhbFN0b3JhZ2UsICRodHRwLCAkbG9jYXRpb24sIGNhcikgLT5cbiAgICAkc2NvcGUuY2FycyA9IFtdXG4gICAgJHNjb3BlLm5ldHdvcmsgPSAkbG9jYWxTdG9yYWdlLm5ldHdvcmtcblxuICAgICRzY29wZS5zY2FuID0gLT5cbiAgICAgICAgJHNjb3BlLmNhcnMubGVuZ3RoID0gMFxuICAgICAgICAkbG9jYWxTdG9yYWdlLm5ldHdvcmsgPSAkc2NvcGUubmV0d29ya1xuXG4gICAgICAgIGZvciBpIGluIFsxLi4yNTRdXG4gICAgICAgICAgICBhZGRyZXNzID0gXCIjeyAkc2NvcGUubmV0d29yayB9I3sgaSB9XCJcblxuICAgICAgICAgICAgdXJsID0gXCJodHRwOi8vI3thZGRyZXNzfTo0MjQyL1wiXG4gICAgICAgICAgICAkaHR0cC5nZXQodXJsKS50aGVuKFxuICAgICAgICAgICAgICAgIChyZXN1bHQpIC0+XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jYXJzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiByZXN1bHQuY29uZmlnLnVybFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogcmVzdWx0LmRhdGEubmFtZVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC0+XG4gICAgICAgICAgICApXG5cbiAgICBpZiAkc2NvcGUubmV0d29ya1xuICAgICAgICAkc2NvcGUuc2NhbigpXG5cbiAgICAkc2NvcGUub3BlbkNhciA9IChjdXJyZW50Q2FyKSAtPlxuICAgICAgICBjYXIuc2V0Q3VycmVudENhcihjdXJyZW50Q2FyKVxuICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2N1cnJlbnQvJykiLCJhbmd1bGFyLm1vZHVsZSgnUlBpQ2FyJylcbi5zZXJ2aWNlICdjYXInLCAoJGxvY2FsU3RvcmFnZSkgLT5cblxuICAgIHRoaXMuc2V0Q3VycmVudENhciA9IChjYXIpIC0+XG4gICAgICAgICRsb2NhbFN0b3JhZ2UuY3VycmVudENhciA9IGNhclxuXG4gICAgdGhpcy5nZXRDdXJyZW50Q2FyID0gLT5cbiAgICAgICAgcmV0dXJuICRsb2NhbFN0b3JhZ2UuY3VycmVudENhclxuXG4gICAgcmV0dXJuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
